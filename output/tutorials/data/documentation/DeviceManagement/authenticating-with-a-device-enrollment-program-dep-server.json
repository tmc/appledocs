{"variants":[{"traits":[{"interfaceLanguage":"data"}],"paths":["/documentation/devicemanagement/authenticating-with-a-device-enrollment-program-dep-server"]}],"sections":[],"metadata":{"title":"Authenticating with a Device Enrollment Program (DEP) Server","role":"collectionGroup","modules":[{"name":"Device Management"}]},"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"anchor":"overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The device enrollment program (DEP) uses a server token to allow a Mobile Device Management (MDM) server to securely communicate with a DEP web service."}]},{"type":"heading","level":3,"anchor":"Get-a-DEP-Server-Token","text":"Get a DEP Server Token"},{"type":"paragraph","inlineContent":[{"text":"To get a DEP server token, the user must complete the following steps. The MDM server product can help by automating some of the steps.","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Generate a public/private key pair in Privacy Enhanced Mail (PEM) format for the MDM server, and store the private key securely on the server.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Sign into the DEP web portal."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a new virtual MDM server."}]}]},{"content":[{"inlineContent":[{"text":"Upload a PEM-encoded X.509 certificate that contains the public key generated in step 1.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Download the S/MIME-encrypted (Secure/Multipurpose Internet Mail Extensions) token file generated by the program web portal."}]}]},{"content":[{"inlineContent":[{"text":"Decrypt the S/MIME token.","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Upload the token file to the MDM server."}]}]}]},{"type":"paragraph","inlineContent":[{"text":"The token consists of these 4 items: the consumer key, the consumer secret, the access token, and the access secret. See ","type":"text"},{"type":"reference","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens","isActive":true},{"text":" for more details.","type":"text"}]},{"type":"heading","level":3,"anchor":"Deploy-the-Server-Token","text":"Deploy the Server Token"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The server tokens can be deployed automatically or manually."}]},{"type":"termList","items":[{"definition":{"content":[{"inlineContent":[{"type":"text","text":"The MDM server must automatically decrypt this file when it’s uploaded to the system, using the private key for the DEP web services."}],"type":"paragraph"}]},"term":{"inlineContent":[{"type":"text","text":"Automatically"}]}},{"definition":{"content":[{"inlineContent":[{"text":"Use the private key and an S/MIME encryption utility to manually decrypt the encrypted token file before it is uploaded to the MDM server. The MDM server then uses the plain-text token file for authentication with the DEP services.","type":"text"}],"type":"paragraph"}]},"term":{"inlineContent":[{"type":"text","text":"Manually"}]}}]},{"type":"heading","level":3,"anchor":"Use-the-OAuth-Credentials","text":"Use the OAuth Credentials"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Each service request to the MDM enrollment service must include an "},{"type":"codeVoice","code":"X-ADM-Auth-Session"},{"type":"text","text":" header. If the request does not have a valid "},{"type":"codeVoice","code":"X-ADM-Auth-Session"},{"type":"text","text":" header, or the auth token has expired, the server returns an "},{"type":"codeVoice","code":"HTTP 401 Unauthorized"},{"type":"text","text":" error. A new "},{"type":"codeVoice","code":"X-ADM-Auth-Session"},{"type":"text","text":" can be requested by using the "},{"type":"codeVoice","code":"https://mdmenrollment.apple.com/session"},{"type":"text","text":" endpoint. This endpoint supports the OAuth 1.0a protocol for accessing protected resources."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"OAuth requests must provide the server-token fields along with a timestamp (in seconds since January 1, 1970 00:00:00 GMT) and a cryptographically random nonce that must be unique for all requests made with a given timestamp. Sign the request using HMAC-SHA1, as described in "},{"type":"reference","identifier":"http://oauth.net/core/1.0a/#signing_process","isActive":true},{"type":"text","text":".  A request might look like:"}]},{"type":"codeListing","syntax":"javascript","code":["GET /session HTTP/1.1    ","Authorization: OAuth realm=\"ADM\",","       oauth_consumer_key=\"CK_00fadb3d36c6094cf479838455321b7c\",","       oauth_token=\"AT_O2109279022Oe03b641fd6f07d7face7894211d521fd8bef09c3O137392\",","       oauth_signature_method=\"HMAC-SHA1\",","       oauth_signature=\"wOJIO9A2W5mFwDgiDvZbTSMK%2FPY%3D\",","       oauth_timestamp=\"137131200\",","       oauth_nonce=\"4572616e48616d6d65724c61686176\",","       oauth_version=\"1.0\"",""]},{"name":"Note","style":"note","type":"aside","content":[{"inlineContent":[{"type":"text","text":""},{"type":"text","text":" "},{"type":"text","text":"Multiline headers are deprectated in RFC7230, though are presented above on multiple lines for readability. Your app should use a single line for its request."}],"type":"paragraph"}]},{"type":"paragraph","inlineContent":[{"text":"The token service validates the request and replies with a JSON payload containing a single key, ","type":"text"},{"type":"codeVoice","code":"auth_session_token"},{"type":"text","text":", that contains the new "},{"type":"codeVoice","code":"X-ADM-Auth-Session"},{"text":" token. A sample response might look like:","type":"text"}]},{"type":"codeListing","syntax":"javascript","code":["HTTP/1.1 200 OK","Date: Thu, 28 Feb 2013 02:24:28 GMT","Content-Type: application/json;charset=UTF8","Content-Length: 47 ","Connection: close","","{","    \"auth_session_token\" : \"87a235815b8d6661ac73329f75815b8d6661ac73329f815\"","}",""]},{"type":"paragraph","inlineContent":[{"text":"After a period of time, the token expires and the service returns a ","type":"text"},{"type":"codeVoice","code":"401"},{"text":" error code. When this happens, the MDM server must request a new session token.","type":"text"}]},{"name":"Note","style":"note","type":"aside","content":[{"inlineContent":[{"text":"","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"The Device Enrollment Program service periodically issues a new "},{"code":"X-ADM-Auth-Session","type":"codeVoice"},{"type":"text","text":" in its response to other service calls. The MDM server should use this new header value in subsequent calls."}],"type":"paragraph"}]}]}],"seeAlsoSections":[{"generated":true,"anchor":"Authentication","identifiers":["doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views"],"title":"Authentication"}],"schemaVersion":{"major":0,"minor":3,"patch":0},"hierarchy":{"paths":[["doc://com.apple.documentation/documentation/technologies","doc://com.apple.devicemanagement/documentation/DeviceManagement","doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment"]]},"identifier":{"interfaceLanguage":"data","url":"doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-with-a-device-enrollment-program-dep-server"},"topicSections":[{"anchor":"Examples-and-Error-Codes","identifiers":["doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens","doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes"],"title":"Examples and Error Codes"}],"abstract":[{"type":"text","text":"Communicate securely with a DEP web service, using a server token."}],"kind":"article","references":{"doc://com.apple.devicemanagement/documentation/DeviceManagement":{"role":"collection","title":"Device Management","kind":"symbol","type":"topic","abstract":[{"type":"text","text":"Manage your organization’s devices remotely."}],"url":"/documentation/devicemanagement","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement"},"doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes":{"type":"topic","url":"/documentation/devicemanagement/dep-server-interpreting-error-codes","abstract":[{"type":"text","text":"Interpret the error codes you might encounter or that can happen during authentication."}],"role":"article","title":"Interpreting Error Codes","kind":"article","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes"},"http://oauth.net/core/1.0a/#signing_process":{"identifier":"http://oauth.net/core/1.0a/#signing_process","title":"http://oauth.net/core/1.0a/#signing_process","type":"link","titleInlineContent":[{"text":"http://oauth.net/core/1.0a/#signing_process","type":"text"}],"url":"http://oauth.net/core/1.0a/#signing_process"},"doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views":{"role":"article","url":"/documentation/devicemanagement/authenticating-through-web-views","kind":"article","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views","type":"topic","abstract":[{"type":"text","text":"Use your own custom web interfaces to authenticate users."}],"title":"Authenticating Through Web Views"},"doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens":{"role":"article","url":"/documentation/devicemanagement/examining-server-tokens","kind":"article","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens","type":"topic","abstract":[{"type":"text","text":"View sample encrypted and unencrypted tokens to verify your server tokens are in the right format."}],"title":"Examining Server Tokens"},"doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment":{"type":"topic","url":"/documentation/devicemanagement/device-assignment","kind":"article","identifier":"doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment","title":"Device Assignment","role":"collectionGroup","abstract":[{"type":"text","text":"Manage devices for your students and employees."}]},"doc://com.apple.documentation/documentation/technologies":{"type":"topic","url":"/documentation/technologies","title":"Technologies","abstract":[{"type":"text","text":""}],"kind":"technologies","identifier":"doc://com.apple.documentation/documentation/technologies","role":"overview"}},"legalNotices":{"copyright":"Copyright &copy; 2025 Apple Inc. All rights reserved.","termsOfUse":"https://www.apple.com/legal/internet-services/terms/site.html","privacyPolicy":"https://www.apple.com/privacy/privacy-policy"}}
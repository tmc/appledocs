{
  "abstract": [
    {
      "text": "Communicate securely with a DEP web service, using a server token.",
      "type": "text"
    }
  ],
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment"
      ]
    ]
  },
  "identifier": {
    "interfaceLanguage": "data",
    "url": "doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-with-a-device-enrollment-program-dep-server"
  },
  "kind": "article",
  "legalNotices": {
    "copyright": "Copyright &copy; 2025 Apple Inc. All rights reserved.",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html"
  },
  "metadata": {
    "modules": [
      {
        "name": "Device Management"
      }
    ],
    "role": "collectionGroup",
    "title": "Authenticating with a Device Enrollment Program (DEP) Server"
  },
  "primaryContentSections": [
    {
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "The device enrollment program (DEP) uses a server token to allow a Mobile Device Management (MDM) server to securely communicate with a DEP web service.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "Get-a-DEP-Server-Token",
          "level": 3,
          "text": "Get a DEP Server Token",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "To get a DEP server token, the user must complete the following steps. The MDM server product can help by automating some of the steps.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "items": [
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Generate a public/private key pair in Privacy Enhanced Mail (PEM) format for the MDM server, and store the private key securely on the server.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Sign into the DEP web portal.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Create a new virtual MDM server.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Upload a PEM-encoded X.509 certificate that contains the public key generated in step 1.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Download the S/MIME-encrypted (Secure/Multipurpose Internet Mail Extensions) token file generated by the program web portal.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Decrypt the S/MIME token.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            },
            {
              "content": [
                {
                  "inlineContent": [
                    {
                      "text": "Upload the token file to the MDM server.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            }
          ],
          "type": "orderedList"
        },
        {
          "inlineContent": [
            {
              "text": "The token consists of these 4 items: the consumer key, the consumer secret, the access token, and the access secret. See ",
              "type": "text"
            },
            {
              "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": " for more details.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "Deploy-the-Server-Token",
          "level": 3,
          "text": "Deploy the Server Token",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "The server tokens can be deployed automatically or manually.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "items": [
            {
              "definition": {
                "content": [
                  {
                    "inlineContent": [
                      {
                        "text": "The MDM server must automatically decrypt this file when itâ€™s uploaded to the system, using the private key for the DEP web services.",
                        "type": "text"
                      }
                    ],
                    "type": "paragraph"
                  }
                ]
              },
              "term": {
                "inlineContent": [
                  {
                    "text": "Automatically",
                    "type": "text"
                  }
                ]
              }
            },
            {
              "definition": {
                "content": [
                  {
                    "inlineContent": [
                      {
                        "text": "Use the private key and an S/MIME encryption utility to manually decrypt the encrypted token file before it is uploaded to the MDM server. The MDM server then uses the plain-text token file for authentication with the DEP services.",
                        "type": "text"
                      }
                    ],
                    "type": "paragraph"
                  }
                ]
              },
              "term": {
                "inlineContent": [
                  {
                    "text": "Manually",
                    "type": "text"
                  }
                ]
              }
            }
          ],
          "type": "termList"
        },
        {
          "anchor": "Use-the-OAuth-Credentials",
          "level": 3,
          "text": "Use the OAuth Credentials",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "Each service request to the MDM enrollment service must include an ",
              "type": "text"
            },
            {
              "code": "X-ADM-Auth-Session",
              "type": "codeVoice"
            },
            {
              "text": " header. If the request does not have a valid ",
              "type": "text"
            },
            {
              "code": "X-ADM-Auth-Session",
              "type": "codeVoice"
            },
            {
              "text": " header, or the auth token has expired, the server returns an ",
              "type": "text"
            },
            {
              "code": "HTTP 401 Unauthorized",
              "type": "codeVoice"
            },
            {
              "text": " error. A new ",
              "type": "text"
            },
            {
              "code": "X-ADM-Auth-Session",
              "type": "codeVoice"
            },
            {
              "text": " can be requested by using the ",
              "type": "text"
            },
            {
              "code": "https://mdmenrollment.apple.com/session",
              "type": "codeVoice"
            },
            {
              "text": " endpoint. This endpoint supports the OAuth 1.0a protocol for accessing protected resources.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "OAuth requests must provide the server-token fields along with a timestamp (in seconds since January 1, 1970 00:00:00 GMT) and a cryptographically random nonce that must be unique for all requests made with a given timestamp. Sign the request using HMAC-SHA1, as described in ",
              "type": "text"
            },
            {
              "identifier": "http://oauth.net/core/1.0a/#signing_process",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": ".  A request might look like:",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "GET /session HTTP/1.1    ",
            "Authorization: OAuth realm=\"ADM\",",
            "       oauth_consumer_key=\"CK_00fadb3d36c6094cf479838455321b7c\",",
            "       oauth_token=\"AT_O2109279022Oe03b641fd6f07d7face7894211d521fd8bef09c3O137392\",",
            "       oauth_signature_method=\"HMAC-SHA1\",",
            "       oauth_signature=\"wOJIO9A2W5mFwDgiDvZbTSMK%2FPY%3D\",",
            "       oauth_timestamp=\"137131200\",",
            "       oauth_nonce=\"4572616e48616d6d65724c61686176\",",
            "       oauth_version=\"1.0\"",
            ""
          ],
          "syntax": "javascript",
          "type": "codeListing"
        },
        {
          "content": [
            {
              "inlineContent": [
                {
                  "text": "",
                  "type": "text"
                },
                {
                  "text": " ",
                  "type": "text"
                },
                {
                  "text": "Multiline headers are deprectated in RFC7230, though are presented above on multiple lines for readability. Your app should use a single line for its request.",
                  "type": "text"
                }
              ],
              "type": "paragraph"
            }
          ],
          "name": "Note",
          "style": "note",
          "type": "aside"
        },
        {
          "inlineContent": [
            {
              "text": "The token service validates the request and replies with a JSON payload containing a single key, ",
              "type": "text"
            },
            {
              "code": "auth_session_token",
              "type": "codeVoice"
            },
            {
              "text": ", that contains the new ",
              "type": "text"
            },
            {
              "code": "X-ADM-Auth-Session",
              "type": "codeVoice"
            },
            {
              "text": " token. A sample response might look like:",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "HTTP/1.1 200 OK",
            "Date: Thu, 28 Feb 2013 02:24:28 GMT",
            "Content-Type: application/json;charset=UTF8",
            "Content-Length: 47 ",
            "Connection: close",
            "",
            "{",
            "    \"auth_session_token\" : \"87a235815b8d6661ac73329f75815b8d6661ac73329f815\"",
            "}",
            ""
          ],
          "syntax": "javascript",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "text": "After a period of time, the token expires and the service returns a ",
              "type": "text"
            },
            {
              "code": "401",
              "type": "codeVoice"
            },
            {
              "text": " error code. When this happens, the MDM server must request a new session token.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "content": [
            {
              "inlineContent": [
                {
                  "text": "",
                  "type": "text"
                },
                {
                  "text": " ",
                  "type": "text"
                },
                {
                  "text": "The Device Enrollment Program service periodically issues a new ",
                  "type": "text"
                },
                {
                  "code": "X-ADM-Auth-Session",
                  "type": "codeVoice"
                },
                {
                  "text": " in its response to other service calls. The MDM server should use this new header value in subsequent calls.",
                  "type": "text"
                }
              ],
              "type": "paragraph"
            }
          ],
          "name": "Note",
          "style": "note",
          "type": "aside"
        }
      ],
      "kind": "content"
    }
  ],
  "references": {
    "doc://com.apple.devicemanagement/documentation/DeviceManagement": {
      "abstract": [
        {
          "text": "Manage your organizationâ€™s devices remotely.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement",
      "kind": "symbol",
      "role": "collection",
      "title": "Device Management",
      "type": "topic",
      "url": "/documentation/devicemanagement"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views": {
      "abstract": [
        {
          "text": "Use your own custom web interfaces to authenticate users.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views",
      "kind": "article",
      "role": "article",
      "title": "Authenticating Through Web Views",
      "type": "topic",
      "url": "/documentation/devicemanagement/authenticating-through-web-views"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes": {
      "abstract": [
        {
          "text": "Interpret the error codes you might encounter or that can happen during authentication.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes",
      "kind": "article",
      "role": "article",
      "title": "Interpreting Error Codes",
      "type": "topic",
      "url": "/documentation/devicemanagement/dep-server-interpreting-error-codes"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment": {
      "abstract": [
        {
          "text": "Manage devices for your students and employees.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/device-assignment",
      "kind": "article",
      "role": "collectionGroup",
      "title": "Device Assignment",
      "type": "topic",
      "url": "/documentation/devicemanagement/device-assignment"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens": {
      "abstract": [
        {
          "text": "View sample encrypted and unencrypted tokens to verify your server tokens are in the right format.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens",
      "kind": "article",
      "role": "article",
      "title": "Examining Server Tokens",
      "type": "topic",
      "url": "/documentation/devicemanagement/examining-server-tokens"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "abstract": [
        {
          "text": "",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "kind": "technologies",
      "role": "overview",
      "title": "Technologies",
      "type": "topic",
      "url": "/documentation/technologies"
    },
    "http://oauth.net/core/1.0a/#signing_process": {
      "identifier": "http://oauth.net/core/1.0a/#signing_process",
      "title": "http://oauth.net/core/1.0a/#signing_process",
      "titleInlineContent": [
        {
          "text": "http://oauth.net/core/1.0a/#signing_process",
          "type": "text"
        }
      ],
      "type": "link",
      "url": "http://oauth.net/core/1.0a/#signing_process"
    }
  },
  "schemaVersion": {
    "major": 0,
    "minor": 3,
    "patch": 0
  },
  "sections": [],
  "seeAlsoSections": [
    {
      "anchor": "Authentication",
      "generated": true,
      "identifiers": [
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/authenticating-through-web-views"
      ],
      "title": "Authentication"
    }
  ],
  "topicSections": [
    {
      "anchor": "Examples-and-Error-Codes",
      "identifiers": [
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/examining-server-tokens",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/dep-server-interpreting-error-codes"
      ],
      "title": "Examples and Error Codes"
    }
  ],
  "variants": [
    {
      "paths": [
        "/documentation/devicemanagement/authenticating-with-a-device-enrollment-program-dep-server"
      ],
      "traits": [
        {
          "interfaceLanguage": "data"
        }
      ]
    }
  ]
}

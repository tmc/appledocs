{
  "abstract": [
    {
      "text": "Understand the steps of the OAuth2 flow between the user, client, server, and Apple services.",
      "type": "text"
    }
  ],
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/user-enrollment",
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/onboarding-users-with-account-sign-in"
      ]
    ]
  },
  "identifier": {
    "interfaceLanguage": "data",
    "url": "doc://com.apple.devicemanagement/documentation/DeviceManagement/implementing-the-oauth2-authentication-user-enrollment-flow"
  },
  "kind": "article",
  "legalNotices": {
    "copyright": "Copyright &copy; 2025 Apple Inc. All rights reserved.",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html"
  },
  "metadata": {
    "modules": [
      {
        "name": "Device Management"
      }
    ],
    "role": "article",
    "roleHeading": "Article",
    "title": "Implementing the OAuth2 authentication user-enrollment flow"
  },
  "primaryContentSections": [
    {
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "To implement user enrollment, you must support a series of interactions between the user’s device and your MDM server. The diagrams below illustrates the interactions with the text describing the interactions in more detail.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "identifier": "media-4091474",
              "type": "image"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "To implement the OAuth2 flow, steps 1-4 are identical to the simple flow explained in ",
              "type": "text"
            },
            {
              "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/implementing-the-simple-authentication-user-enrollment-flow",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": ".",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "401-response",
          "level": 3,
          "text": "401 response",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "In step 5 above, the server returns an ",
              "type": "text"
            },
            {
              "code": "HTTP 401",
              "type": "codeVoice"
            },
            {
              "text": " response status to the client and includes a ",
              "type": "text"
            },
            {
              "code": "WWW-Authenticate",
              "type": "codeVoice"
            },
            {
              "text": " response header. This response header must use the ",
              "type": "text"
            },
            {
              "code": "Bearer",
              "type": "codeVoice"
            },
            {
              "text": " scheme and include the following parameters:",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "header": "row",
          "rows": [
            [
              [
                {
                  "inlineContent": [
                    {
                      "text": "Name",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "Content",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "method",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "(Required) A string that must be ",
                      "type": "text"
                    },
                    {
                      "code": "apple-oauth2",
                      "type": "codeVoice"
                    },
                    {
                      "text": ", defining the authentication protocol.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "authorization-url",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "(Required) The OAuth2 protocol authorization endpoint URL, for the initial ASWebAuthenticationSession HTTP request. The URL scheme must be ",
                      "type": "text"
                    },
                    {
                      "code": "https",
                      "type": "codeVoice"
                    },
                    {
                      "text": ".",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "token-url",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "(Required) The OAuth2 protocol token endpoint URL, for the token request. The URL scheme must be ",
                      "type": "text"
                    },
                    {
                      "code": "https",
                      "type": "codeVoice"
                    },
                    {
                      "text": ".",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "redirect-url",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "(Required) The OAuth2 protocol redirection endpoint URL, where the OAuth2 authorization request redirects to on success. Since the authorization request uses the ",
                      "type": "text"
                    },
                    {
                      "identifier": "doc://com.apple.documentation/documentation/AuthenticationServices/ASWebAuthenticationSession",
                      "isActive": true,
                      "type": "reference"
                    },
                    {
                      "text": " protocol, this URL scheme must be set to ",
                      "type": "text"
                    },
                    {
                      "code": "apple-remotemanagement-user-login",
                      "type": "codeVoice"
                    },
                    {
                      "text": " and have a path component set to the server’s redirection endpoint.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "client-id",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "(Required) The OAuth2 protocol client identifier that the client must use in the OAuth2 authorization request.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ],
            [
              [
                {
                  "inlineContent": [
                    {
                      "code": "scope",
                      "type": "codeVoice"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              [
                {
                  "inlineContent": [
                    {
                      "text": "The OAuth2 protocol access token scope the client must use in the OAuth2 authorization request.",
                      "type": "text"
                    }
                  ],
                  "type": "paragraph"
                }
              ]
            ]
          ],
          "type": "table"
        },
        {
          "inlineContent": [
            {
              "text": "If the client’s enrollment request is invalid, the server returns a standard HTTP error response code (for example, 400 or 403) to halt the enrollment flow on the device. If the server’s response is invalid (for example, missing the ",
              "type": "text"
            },
            {
              "code": "WWW-Authenticate",
              "type": "codeVoice"
            },
            {
              "text": " response header), then the system cancels the enrollment.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "identifier": "media-4091472",
              "type": "image"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "Authorization-request",
          "level": 3,
          "text": "Authorization request",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "In steps 6-10 above, the client starts the OAuth2 authorization grant flow by constructing the authorization request URL from the parameters returned in the 401 response, and adds a query item with the name ",
              "type": "text"
            },
            {
              "code": "login_hint",
              "type": "codeVoice"
            },
            {
              "text": ", with its value set to the user account identifier entered by the user.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The client creates an ",
              "type": "text"
            },
            {
              "identifier": "doc://com.apple.documentation/documentation/AuthenticationServices/ASWebAuthenticationSession",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": " using the authorization request URL and a callback scheme set to ",
              "type": "text"
            },
            {
              "code": "apple-remotemanagement-user-login",
              "type": "codeVoice"
            },
            {
              "text": ", and starts the session.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The authentication session does an ",
              "type": "text"
            },
            {
              "code": "HTTPS GET",
              "type": "codeVoice"
            },
            {
              "text": " request for the OAuth2 authorization request URL, and includes the appropriate query parameters needed for the authorization code grant request. The device presents any resulting HTML data to the user in a web view.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The OAuth2 authorization server responding to the request can pre-populate any user id form field by extracting the relevant items from the request’s ",
              "type": "text"
            },
            {
              "code": "login_hint",
              "type": "codeVoice"
            },
            {
              "text": " query item. The server can also use that query item to customize the form based on the user name or domain portions of the user account identifier.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "identifier": "doc://com.apple.documentation/documentation/AuthenticationServices/ASWebAuthenticationSession",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": " supports most types of browser based single sign-on, multi-factor, or federated authentication. There can be several round trips between the client and the authorization server to complete authentication.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The user does have the option of canceling out of the web-view at any time, and that terminates the authentication flow and the enrollment.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "<<<<< Request",
            "GET /oauth2/authorization?response_type=code",
            "    &client_id=03FDDE96-FDAB-45EF-A589-0E29C026E824",
            "    &redirect_uri=apple-remotemanagement-user-login:/oauth2/redirection",
            "    &state=340B948D-A84A-45A3-AC45-C93195124B00",
            "    &login_hint=useroauth@example.com HTTP/1.1",
            "Host: mdmserver.example.com",
            "",
            ">>>>> Response",
            "HTTP/1.1 200 OK",
            "Content-Type: text/html; charset=\"utf-8\"",
            "Content-Length: 17643",
            "",
            "<!DOCTYPE html>",
            "<html>",
            "…",
            "</html>"
          ],
          "syntax": "swift",
          "type": "codeListing"
        },
        {
          "anchor": "Authorization-response",
          "level": 3,
          "text": "Authorization response",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "In step 11 above, the authentication session web flow completes when the server returns an HTTP 308 permanent redirect response to the client, with a ",
              "type": "text"
            },
            {
              "code": "Location",
              "type": "codeVoice"
            },
            {
              "text": " header set to the ",
              "type": "text"
            },
            {
              "code": "redirect-url",
              "type": "codeVoice"
            },
            {
              "text": " parameter value returned in step 5. The URL must also include the OAuth2 protocol ",
              "type": "text"
            },
            {
              "code": "code",
              "type": "codeVoice"
            },
            {
              "text": " and ",
              "type": "text"
            },
            {
              "code": "state",
              "type": "codeVoice"
            },
            {
              "text": " query items (note the client always sets a ",
              "type": "text"
            },
            {
              "code": "state",
              "type": "codeVoice"
            },
            {
              "text": " parameter in its authorization request, so the server must always set it in the authorization response).",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "<<<<< Request",
            "POST /oauth2/results HTTP/1.1",
            "Content-Type: multipart/form-data; boundary=----WebKitFormBoundarySaBDj3Bd7BeKC1s2",
            "Content-Length: 236",
            "",
            "------WebKitFormBoundarySaBDj3Bd7BeKC1s2",
            "Content-Disposition: form-data; name=\"username\"",
            "",
            "user01",
            "------WebKitFormBoundarySaBDj3Bd7BeKC1s2",
            "Content-Disposition: form-data; name=\"password\"",
            "",
            "secret",
            "------WebKitFormBoundarySaBDj3Bd7BeKC1s2--",
            "",
            ">>>>> Response",
            "HTTP/1.1 308 Permanent Redirect",
            "Content-Length: 0",
            "Location: apple-remotemanagement-user-login:/oauth2/redirection",
            "    ?code=Dek1jUOEcaIPGhbDrCTm9GDV5qT1sb&state=340B948D-A84A-45A3-AC45-C93195124B00"
          ],
          "syntax": "other",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "identifier": "media-4091471",
              "type": "image"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "Token-request-and-response",
          "level": 3,
          "text": "Token request and response",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "In steps 12-13 above, the client then makes a token access request to fetch the OAuth2 access and (optional) refresh tokens, using the authorization grant code returned in step 11, along with other required OAuth2 parameters. The client securely stores the tokens returned by the server for use when authorizing subsequent requests to the server.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "If authentication fails, the server should return an appropriate HTTP error response code that terminates the enrollment on the device.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "<<<<< Request",
            "POST /oauth2/token HTTP/1.1",
            "Content-Type: application/x-www-form-urlencoded",
            "Content-Length: 195",
            "",
            "grant_type=authorization_code",
            "    &code=Dek1jUOEcaIPGhbDrCTm9GDV5qT1sb",
            "    &redirect_uri=apple-remotemanagement-user-login:/oauth2/redirection",
            "    &client_id=03FDDE96-FDAB-45EF-A589-0E29C026E824",
            "",
            ">>>>> Response",
            "HTTP/1.1 200 OK",
            "Content-Length: 245",
            "Content-Type: application/json",
            "",
            "{",
            "    \"token_type\": \"Bearer\",",
            "    \"scope\": \"MDM\",",
            "    \"access_token\": \"dXNlcm9hdXRo.MjZkNTkzZmMtNzk4MC00OWFkLTllZTAtZTA2NzhmNmVhNzg5\",",
            "    \"expires_in\": 3600,",
            "    \"refresh_token\": \"dXNlcm9hdXRo.NzhiNWU0NWQtMDVlZS00MTAwLThhMjEtZDA5MzI2N2RjNzUx\"",
            "}"
          ],
          "syntax": "other",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "identifier": "media-4091473",
              "type": "image"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "Second-enrollment-attempt-to-enrollment",
          "level": 3,
          "text": "Second enrollment attempt to enrollment",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "In steps 14-21 above, the behavior is identical to the second enrollment attempt from the simple authentication protocol, with the client using the OAuth2 access token value in the ",
              "type": "text"
            },
            {
              "code": "Authorization",
              "type": "codeVoice"
            },
            {
              "text": " HTTP request header.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "Authorization: Bearer dXNlcm9hdXRo.MjZkNTkzZmMtNzk4MC00OWFkLTllZTAtZTA2NzhmNmVhNzg5"
          ],
          "syntax": "other",
          "type": "codeListing"
        }
      ],
      "kind": "content"
    }
  ],
  "references": {
    "doc://com.apple.devicemanagement/documentation/DeviceManagement": {
      "abstract": [
        {
          "text": "Manage your organization’s devices remotely.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement",
      "kind": "symbol",
      "role": "collection",
      "title": "Device Management",
      "type": "topic",
      "url": "/documentation/devicemanagement"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/implementing-the-simple-authentication-user-enrollment-flow": {
      "abstract": [
        {
          "text": "Understand the steps of the authentication flow between the user, client, server, and Apple services.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/implementing-the-simple-authentication-user-enrollment-flow",
      "kind": "article",
      "role": "article",
      "title": "Implementing the simple authentication user-enrollment flow",
      "type": "topic",
      "url": "/documentation/devicemanagement/implementing-the-simple-authentication-user-enrollment-flow"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/onboarding-users-with-account-sign-in": {
      "abstract": [
        {
          "text": "Examine new, user-initiated, identity-focused flows.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/onboarding-users-with-account-sign-in",
      "kind": "article",
      "role": "collectionGroup",
      "title": "Onboarding users with account sign-in",
      "type": "topic",
      "url": "/documentation/devicemanagement/onboarding-users-with-account-sign-in"
    },
    "doc://com.apple.devicemanagement/documentation/DeviceManagement/user-enrollment": {
      "abstract": [
        {
          "text": "Authenticate devices using an user identity focused workflow.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.devicemanagement/documentation/DeviceManagement/user-enrollment",
      "kind": "article",
      "role": "collectionGroup",
      "title": "User Enrollment",
      "type": "topic",
      "url": "/documentation/devicemanagement/user-enrollment"
    },
    "doc://com.apple.documentation/documentation/AuthenticationServices/ASWebAuthenticationSession": {
      "abstract": [
        {
          "text": "A session that an app uses to authenticate a user through a web service.",
          "type": "text"
        }
      ],
      "fragments": [
        {
          "kind": "keyword",
          "text": "class"
        },
        {
          "kind": "text",
          "text": " "
        },
        {
          "kind": "identifier",
          "text": "ASWebAuthenticationSession"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/AuthenticationServices/ASWebAuthenticationSession",
      "kind": "symbol",
      "role": "symbol",
      "title": "ASWebAuthenticationSession",
      "type": "topic",
      "url": "/documentation/AuthenticationServices/ASWebAuthenticationSession"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "abstract": [
        {
          "text": "",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "kind": "technologies",
      "role": "overview",
      "title": "Technologies",
      "type": "topic",
      "url": "/documentation/technologies"
    },
    "media-4091471": {
      "alt": "A sequence diagram showing interactions 12 and 13 between the user, client, server, and Apple servers for OAuth2 authentication.",
      "identifier": "media-4091471",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x",
            "light"
          ],
          "url": "https://docs-assets.developer.apple.com/published/a35a8a1b9c4a92b221ca627681a6fa5c/media-4091471@2x.png"
        },
        {
          "traits": [
            "2x",
            "dark"
          ],
          "url": "https://docs-assets.developer.apple.com/published/c96f07bb8214cedff18c6d8a4fbef1e6/media-4091471~dark@2x.png"
        }
      ]
    },
    "media-4091472": {
      "alt": "A sequence diagram showing interactions 6-11 between the user, client, server, and Apple servers for OAuth2 authentication.",
      "identifier": "media-4091472",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x",
            "light"
          ],
          "url": "https://docs-assets.developer.apple.com/published/28b776ef1f3d2b49cde6c822b6ae94f0/media-4091472@2x.png"
        },
        {
          "traits": [
            "2x",
            "dark"
          ],
          "url": "https://docs-assets.developer.apple.com/published/c8026c8f7576c9d90ef1cb1ccac48cf3/media-4091472~dark@2x.png"
        }
      ]
    },
    "media-4091473": {
      "alt": "A sequence diagram showing interactions 14-20 between the user, client, server, and Apple servers for OAuth2 authentication.",
      "identifier": "media-4091473",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x",
            "light"
          ],
          "url": "https://docs-assets.developer.apple.com/published/6a9f1c4d34cfffc5b380b886414e97cb/media-4091473@2x.png"
        },
        {
          "traits": [
            "2x",
            "dark"
          ],
          "url": "https://docs-assets.developer.apple.com/published/45fdef0ce458e382576de84f6d73ceb2/media-4091473~dark@2x.png"
        }
      ]
    },
    "media-4091474": {
      "alt": "A sequence diagram showing the first five interactions between the user, client, server, and Apple servers for OAuth2 authentication.",
      "identifier": "media-4091474",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x",
            "light"
          ],
          "url": "https://docs-assets.developer.apple.com/published/a73e53fb7a290c25f56fe61ed62a24f9/media-4091474@2x.png"
        },
        {
          "traits": [
            "2x",
            "dark"
          ],
          "url": "https://docs-assets.developer.apple.com/published/a98b208d48fc434aec640c7f6a5bfeb2/media-4091474~dark@2x.png"
        }
      ]
    }
  },
  "schemaVersion": {
    "major": 0,
    "minor": 3,
    "patch": 0
  },
  "sections": [],
  "seeAlsoSections": [
    {
      "anchor": "Detailed-flow-instructions",
      "generated": true,
      "identifiers": [
        "doc://com.apple.devicemanagement/documentation/DeviceManagement/implementing-the-simple-authentication-user-enrollment-flow"
      ],
      "title": "Detailed flow instructions"
    }
  ],
  "variantOverrides": [
    {
      "patch": [
        {
          "op": "replace",
          "path": "/references/doc:~1~1com.apple.documentation~1documentation~1AuthenticationServices~1ASWebAuthenticationSession/fragments",
          "value": [
            {
              "kind": "keyword",
              "text": "@interface"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "identifier",
              "text": "ASWebAuthenticationSession"
            },
            {
              "kind": "text",
              "text": " : "
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:objc(cs)NSObject",
              "text": "NSObject"
            }
          ]
        }
      ],
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ]
    }
  ],
  "variants": [
    {
      "paths": [
        "/documentation/devicemanagement/implementing-the-oauth2-authentication-user-enrollment-flow"
      ],
      "traits": [
        {
          "interfaceLanguage": "data"
        }
      ]
    }
  ]
}

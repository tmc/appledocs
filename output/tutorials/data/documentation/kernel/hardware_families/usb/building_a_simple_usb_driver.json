{
  "abstract": [
    {
      "text": "Set up and load a driver that logs output to the Console app.",
      "type": "text"
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/kernel",
        "doc://com.apple.documentation/documentation/kernel/hardware_families",
        "doc://com.apple.documentation/documentation/kernel/hardware_families/usb"
      ]
    ]
  },
  "identifier": {
    "interfaceLanguage": "occ",
    "url": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver"
  },
  "kind": "article",
  "legacy_identifier": 3618338,
  "legalNotices": {
    "copyright": "Copyright &copy; 2025 Apple Inc. All rights reserved.",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html"
  },
  "metadata": {
    "modules": [
      {
        "name": "Kernel"
      }
    ],
    "platforms": [
      {
        "current": "15.4",
        "introducedAt": "10.15",
        "name": "macOS"
      },
      {
        "current": "16.3",
        "introducedAt": "12.0",
        "name": "Xcode"
      }
    ],
    "role": "sampleCode",
    "roleHeading": "Sample Code",
    "title": "Building a Simple USB Driver"
  },
  "primaryContentSections": [
    {
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "This code project builds a simple USB driver. The driver logs events to the Console and responds to interrupts, such as when the user inserts or removes a device. Because it is a template driver with limited functionality, it can be used as a starting point for a more sophisticated driver.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "3696665",
          "level": 3,
          "text": "Configure the Sample Code Project",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "To run the sample code project in Xcode, make sure to use macOS 10.15.5 or later and Xcode 11.5 or later.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "For the driver to load, System Integrity Protection (SIP) must be off. For more information on this process, see ",
              "type": "text"
            },
            {
              "identifier": "doc://com.apple.security/documentation/Security/disabling-and-enabling-system-integrity-protection",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": ".",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "3696666",
          "level": 3,
          "text": "Select a USB Test Device",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "This sample USB driver works by detecting when a USB device is plugged into a Mac and logging the event. The test device should be unsupported under macOS; otherwise, an existing driver will take precedence, recognize the device, and preempt this sample driver.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The driver detects the device based on a number of critiera inside of the Info.plist’s ",
              "type": "text"
            },
            {
              "code": "IOKitPersonalities > SimpleUSBInterfaceDriver",
              "type": "codeVoice"
            },
            {
              "text": " section, including configuration value, interface number, product identifier, and vendor identifier.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The sample driver requires the following command to find criteria that matches the keys in the Info.plist file for a selected USB device plugged into a Mac:",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "ioreg -w0 -rc IOUSBHostInterface -l"
          ],
          "metadata": {
            "anchor": "3696658",
            "title": "Listing 1"
          },
          "syntax": "swift",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "text": "WIth the device’s parmeters identified and placed in the Info.plist file, the driver loads and intializes the device upon insertion.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "3696667",
          "level": 3,
          "text": "Build and Load the Driver",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "At build time, Xcode runs the “Launch Terminal” run script build phase, which launches the Terminal app in the directory where the newly-built driver resides.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "inlineContent": [
            {
              "text": "The following commands copy the the driver into the home folder, change the current directory to that location, set ownership and permissions, and load the driver.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "sudo cp -R SimpleUSBInterfaceDriver.kext ~",
            "cd ~",
            "sudo chown -R root:wheel SimpleUSBInterfaceDriver.kext",
            "sudo chmod -R 755 SimpleUSBInterfaceDriver.kext",
            "sudo kextload SimpleUSBInterfaceDriver.kext"
          ],
          "metadata": {
            "anchor": "3696660",
            "title": "Listing 2"
          },
          "syntax": "swift",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "text": "The kernel loads the driver and communicates the status through the logging system. The Console app shows the logging messages.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "anchor": "3696668",
          "level": 3,
          "text": "Unload the Driver",
          "type": "heading"
        },
        {
          "inlineContent": [
            {
              "text": "When testing completes, the following command directs the kernel to unload the driver:",
              "type": "text"
            }
          ],
          "type": "paragraph"
        },
        {
          "code": [
            "sudo kextunload SimpleUSBInterfaceDriver.kext"
          ],
          "metadata": {
            "anchor": "3696662",
            "title": "Listing 3"
          },
          "syntax": "swift",
          "type": "codeListing"
        },
        {
          "inlineContent": [
            {
              "text": "It is important to re-enable SIP once driver testing completes. Failure to re-enable SIP leaves the computer vulnerable to malicious code. See ",
              "type": "text"
            },
            {
              "identifier": "doc://com.apple.security/documentation/Security/disabling-and-enabling-system-integrity-protection",
              "isActive": true,
              "type": "reference"
            },
            {
              "text": " for more information.",
              "type": "text"
            }
          ],
          "type": "paragraph"
        }
      ],
      "kind": "content"
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/kernel": {
      "identifier": "doc://com.apple.documentation/documentation/kernel",
      "kind": "symbol",
      "role": "collection",
      "title": "Kernel",
      "type": "topic",
      "url": "/documentation/kernel"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families": {
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families",
      "kind": "article",
      "role": "collectionGroup",
      "title": "Hardware Families",
      "type": "topic",
      "url": "/documentation/kernel/hardware_families"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families/usb": {
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb",
      "kind": "article",
      "role": "collectionGroup",
      "title": "USB",
      "type": "topic",
      "url": "/documentation/kernel/hardware_families/usb"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver": {
      "abstract": [
        {
          "text": "Set up and load a driver that logs output to the Console app.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver",
      "kind": "article",
      "role": "sampleCode",
      "title": "Building a Simple USB Driver",
      "type": "topic",
      "url": "/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696658": {
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696658",
      "kind": "article",
      "role": "codeListing",
      "title": "Listing 1",
      "type": "section",
      "url": "/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696658"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696660": {
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696660",
      "kind": "article",
      "role": "codeListing",
      "title": "Listing 2",
      "type": "section",
      "url": "/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696660"
    },
    "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696662": {
      "identifier": "doc://com.apple.documentation/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696662",
      "kind": "article",
      "role": "codeListing",
      "title": "Listing 3",
      "type": "section",
      "url": "/documentation/kernel/hardware_families/usb/building_a_simple_usb_driver#3696662"
    },
    "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlink": {
      "abstract": [
        {
          "text": "A structure that represents a USB host input/output source client record entry.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlink",
      "kind": "symbol",
      "role": "symbol",
      "title": "IOUSBHostIOSourceClientRecordLink",
      "type": "topic",
      "url": "/documentation/kernel/iousbhostiosourceclientrecordlink"
    },
    "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlist": {
      "abstract": [
        {
          "text": "A structure that represents a list of USB host input/output source client records.",
          "type": "text"
        }
      ],
      "identifier": "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlist",
      "kind": "symbol",
      "role": "symbol",
      "title": "IOUSBHostIOSourceClientRecordList",
      "type": "topic",
      "url": "/documentation/kernel/iousbhostiosourceclientrecordlist"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies",
      "type": "topic",
      "url": "/documentation/technologies"
    },
    "doc://com.apple.security/documentation/Security/disabling-and-enabling-system-integrity-protection": {
      "identifier": "doc://com.apple.security/documentation/Security/disabling-and-enabling-system-integrity-protection",
      "kind": "article",
      "role": "article",
      "title": "Disabling and Enabling System Integrity Protection",
      "type": "topic",
      "url": "/documentation/security/disabling-and-enabling-system-integrity-protection"
    },
    "https://docs-assets.developer.apple.com/published/5a32f9bf23/BuildingASimpleUSBDriver.zip": {
      "checksum": "297f98c50a8344be39c052a30e7e8089a255f5edef3e33b39550778b4bfdbcf038ba44bb1640ca773ca7a8210c38afffff34c1fdf0e3d73215f346a11fa63d04",
      "identifier": "https://docs-assets.developer.apple.com/published/5a32f9bf23/BuildingASimpleUSBDriver.zip",
      "type": "download",
      "url": "https://docs-assets.developer.apple.com/published/5a32f9bf23/BuildingASimpleUSBDriver.zip"
    }
  },
  "sampleCodeDownload": {
    "action": {
      "identifier": "https://docs-assets.developer.apple.com/published/5a32f9bf23/BuildingASimpleUSBDriver.zip",
      "isActive": true,
      "overridingTitle": "Download",
      "type": "reference"
    }
  },
  "schemaVersion": {
    "major": 0,
    "minor": 3,
    "patch": 0
  },
  "sections": [],
  "seeAlsoSections": [
    {
      "generated": true,
      "identifiers": [
        "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlink",
        "doc://com.apple.documentation/documentation/kernel/iousbhostiosourceclientrecordlist"
      ],
      "title": "Device Communication"
    }
  ],
  "variants": [
    {
      "paths": [
        "documentation/kernel/hardware_families/usb/building_a_simple_usb_driver"
      ],
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ]
    }
  ]
}
